\chapter{基礎知識}
本章では，本論文で扱うProgrammable Microfluidic Device（PMD）と呼ばれるバイオチップの基礎知識について説明をする．

%図は図~\ref{fig:label} のように入れます．
\section{PMDのアーキテクチャ}
%セル，バルブ，ミキサーでの液滴の混合など，PMDの基礎動作について説明する．
PMDの顕微鏡写真を図~\ref{fig:PMDMicrograph}に示す．
図~\ref{fig:PMDMicrograph}において，赤黒く見えている部品はバルブと呼ばれる．
また，バルブに囲まれた，青い線の交点となっている領域はセルと呼ばれる．
図~\ref{fig:PMDMicrograph}から分かるように，PMDはバルブに囲まれたセルが格子状に並んだ構造を持つ．

図~\ref{fig:MixingOnPMD}にPMDを用いて2種類の試薬の液滴の混合を行う過程を示す~\cite{4}．
図~\ref{fig:MixingOnPMD}（a）から（b）は，圧力をかけられることで入力ポートから2種類の試薬がPMDへと注入される様子を示す．
図~\ref{fig:MixingOnPMD}（c）は，環状にセルが繋げられたミキサーと呼ばれる流路を示す．
ミキサーは，バルブの開閉の制御を行うことで液滴の混合を行う．
液滴の混合が行われると，図~\ref{fig:MixingOnPMD}（d）で示したようにミキサー上の液滴の濃度は均一になる．

図~\ref{fig:MixingOnPMD}（c）のミキサーは，液滴の混合にPMDの2x2セルを用いる．このような2x2セルを用いるミキサーのことを2x2ミキサーと呼ぶ．
PMDはバルブの開閉の制御を行うことで，2x2ミキサーよりも大きいミキサーや長方形以外の形のミキサーを用いた液滴の混合を行うことも可能である．

\begin{figure}[tbp]
 \centering\includegraphics[scale=1.2]{img/PMDMicrograph.pdf}
 \caption{PMDの顕微鏡写真}\label{fig:PMDMicrograph}
\end{figure}

\begin{figure}[tbp]
    \centering\includegraphics[scale=1.0]{img/PMDMixing_jp.PDF}
    \caption{PMD 上に流し込まれた 2 種類の試薬が混合される様子，参考文献~\cite{4} より引用し一部改変}\label{fig:MixingOnPMD}
\end{figure}

\section{試薬合成}

PMD\mout{上での}ミキサーを用いた液滴の混合を複数回行うことで，狙った比率で試薬が混合された液滴を生成\mout{できる}．
この処理のことを，試薬合成と呼ぶ．図~\ref{fig:NTM}に，\mout{配置優先度を用いた}手法\mout{における}試薬合成の入力データと出力データを示す~\cite{10089903}．
図~\ref{fig:NTM}（a）に，試薬合成の入力データとして用いられる木構造のデータ，混合木を示す．
図~\ref{fig:NTM}の混合木は，R1からR4の4種類の試薬を24:18:12:10で混合する試薬合成を表現している．
混合木の葉の位置にあるノードは，混合に用いる試薬を表現している試薬ノードである．
また，試薬ノード以外のノードはミキサーを用いた液滴の混合を表現している，混合ノードである．
混合ノードM$_i$は，i番目のミキサーでの液滴の混合を表現している．
\mout{以降，図~\ref{fig:relation}のように，混合木において，あるノードWの下方に存在するノードXについて，ノードXはノードWの子ノードであるという．また，その場合ノードWはノードXの親ノードであるという．ノードYもノードWの子ノードである場合，ノードXとノードYは兄弟ノードであるという．}
\mout{また，あるノードZの上方に存在するノードY，Wについて，ノードY，WはノードZの先祖ノードであるという．}


\begin{figure}[tbp]
    \centering\includegraphics[scale=0.7]{img/node_relation.pdf}
    \caption{混合木内のノード間の関係}\label{fig:relation}
\end{figure}


\mout{混合木内のノードの親子関係は，子ノードによってPMD上に残される液滴が，親の位置にある混合ノードによって使用されることを意味する．}
\mout{また，親子関係にあるノード間のエッジに付加された重みは，子ノードによって，親ノードが使用するセルに残す必要のある液滴の個数を表現している．}
\mout{図~\ref{fig:NTM}（a）の混合木において赤い矢印で示したように，図~\ref{fig:NTM}（e）においてM0は，図~\ref{fig:NTM}（d）においてM1での液滴の混合によって生成される緑色の中間液滴2滴，図~\ref{fig:NTM}（b）においてM2での液滴の混合によって生成される黄色の中間液滴1滴，図~\ref{fig:NTM}（b）において配置されるピンク色の試薬液滴1滴を用いて，液滴の混合を行う．}
\gout{\mout{M0}における2:1:1のように，}子\mout{ノードによって，親ノードが使用するセルに残す必要のある}液滴の個数の比のことを提供比率と呼ぶ．

%\mout{混合木を基にPMD上での試薬合成を行う際には，PMD上のどのセルにミキサーや試薬液滴を配置するか決める必要がある．}
%\mout{混合木において，あるノードYの親の位置にあるノードXが混合ノードである場合，ノードXはノードYの親ノードであるという．また，親ノードとなれるのは混合ノードのみであるため，ミキサーXはモジュールYの親ミキサーという．}


%ノード間\mout{の}エッジ\gout{に付加された重み}は，子ノードから親ノードへと提供される液滴の個数を表現している．
%例えば，M$3$，M$2$，R$1$のノードから，親ノードであるM$1$へと張られたエッジに付加された重みの2，1，1は，それぞれのノードからM$1$へと提供される液滴の個数を表している．


%ノード間\mout{の}エッジ\gout{に付加された重み}は，子ノードから親ノードへと提供される液滴の個数を表現している．
%例えば，M$_3$，M$_2$，R$_1$のノードから，親ノードであるM$_1$へと張られたエッジに付加された重みの2，1，1は，それぞれのノードからM$_1$へと提供される液滴の個数を表している．
%また，\gout{M1における2:1:1のように，}子ノードから親ノードへと提供される液滴の個数の比のことを提供比率と呼ぶ．

図~\ref{fig:NTM}（b）から（e）は，図~\ref{fig:NTM}（a）の混合木で表現された試薬合成をPMD上で実行する際の液滴の混合手順を示す．
図~\ref{fig:NTM}（b）ではM$_2$とM$_3$，図~\ref{fig:NTM}（c）ではM$_4$，図~\ref{fig:NTM}（d）ではM$_1$，図~\ref{fig:NTM}（e）ではM$_0$において液滴が混合されている．
\mout{配置優先度を用いた}手法は，図~\ref{fig:NTM}（a）の混合木を入力として受け取り，混合木に基づいて試薬とミキサーの配置場所を探索することで，図~\ref{fig:NTM}（b）から（e）のような液滴の混合手順を生成する．

%PMD\mout{上での}ミキサーを用いた液滴の混合を複数回行うことで，狙った比率で試薬が混合された液滴を生成\mout{できる}．
%この処理のことを，試薬合成と呼ぶ．図~\ref{fig:NTM}に，平井らの手法を用いた試薬合成の入力データと出力データを示す~\cite{10089903}．
%図~\ref{fig:NTM}（a）に，試薬合成の入力データとして用いられる木構造のデータ，混合木を示す．
%図~\ref{fig:NTM}の混合木は，R1からR4の4種類の試薬を24:18:12:10で混合する試薬合成を表現している．
%混合木の葉の位置にあるノードは，混合に用いる試薬\mout{の配置を}表現している試薬ノードである．
%また，試薬ノード以外のノードはミキサーを用いた液滴の混合を表現している，混合ノードである．
%混合ノードM$i$は，i番目のミキサーでの液滴の混合を表現している．
%
%%\mout{混合木は，試薬合成中に各ミキサーで混合される液滴の種類と比率の組み合わせを木構造で表している．}
%%\mout{混合木内の各ノードが表現している，試薬液滴の配置や液滴の混合など，PMD上で実行する操作のことをモジュールと呼ぶ．}
%%\mout{混合木内のノードの親子関係は，子の位置にあるノードのモジュールの実行後PMD上に残される液滴が，親の位置にあるノードのモジュールの実行の際に使用されることを意味する．}
%%\mout{図~\ref{fig:NTM}（e）においてM0は，図~\ref{fig:NTM}（a）の混合木において赤い矢印で示したように，図~\ref{fig:NTM}（d）においてM1での液滴の混合によって生成される緑色の中間液滴2滴，図~\ref{fig:NTM}（b）においてM2での液滴の混合によって生成される黄色の中間液滴1滴，図~\ref{fig:NTM}（b）において配置されるピンク色の試薬液滴1滴を用いて，液滴の混合を行う．}
%%\mout{このように，親子関係にあるノード間のエッジに付加された重みは，子の位置にあるノードのモジュール実行後に，親の位置にあるノードのモジュールが実行されるセルに残す必要のある液滴の個数を表現している．}
%
%%\mout{混合木を基にPMD上での試薬合成を行う際には，PMD上のどのセルで各モジュールを実行するか決める必要がある．}
%%\mout{混合木において，あるノードYの親の位置にあるノードXが混合ノードである場合，ノードXはノードYの親ノードであるという．また，親ノードとなれるのは混合ノードのみであるため，ミキサーXはモジュールYの親ミキサーという．}
%
%
%%ノード間\mout{の}エッジ\gout{に付加された重み}は，子ノードから親ノードへと提供される液滴の個数を表現している．
%%例えば，M$3$，M$2$，R$1$のノードから，親ノードであるM$1$へと張られたエッジに付加された重みの2，1，1は，それぞれのノードからM$1$へと提供される液滴の個数を表している．
%また，\gout{\mout{M0}における2:1:1のように，}子の\mout{位置にあるノードのモジュール実行後に，親の位置にあるノードのモジュールが実行されるセルに残される}液滴の個数の比のことを提供比率と呼ぶ．
%
%図~\ref{fig:NTM}（b）から（e）は，図~\ref{fig:NTM}（a）の混合木で表現された試薬合成をPMD上で実行する際の液滴の混合手順を示す．
%図~\ref{fig:NTM}（b）ではM$2$とM$3$，図~\ref{fig:NTM}（c）ではM$4$，図~\ref{fig:NTM}（d）ではM$1$，図~\ref{fig:NTM}（e）ではM$0$において液滴が混合されている．
%平井らの手法NTMは，図~\ref{fig:NTM}（a）の混合木を入力として受け取り，混合木に基づいて試薬とミキサーの配置場所を探索することで，図~\ref{fig:NTM}（b）から（e）のような液滴の混合手順を生成する．

\begin{figure}[tbp]
    \centering\includegraphics[scale=0.7]{img/NTM_jp.PDF}
    \caption{配置優先度を用いた手法における試薬合成の入力データと出力データ}\label{fig:NTM}
\end{figure}


%\begin{itemize}
%\item 卒論の元となった手法NTMの混合手順の図を例として，PMDを用いた試薬合成について説明する．
%\item 混合木に関して，提供比率などの基礎概念について説明する．
%\begin{itemize}
%\item 試薬合成中に行われる液滴の混合を木構造で表したのが，混合木である．．．
%\end{itemize} 
%\end{itemize} 
\section{フラッシング}
\label{sec:flushing}
%フラッシングという操作自体と，フラッシング回数を減らしたいという研究の動機について説明する．
    PMD上での試薬合成中には，\gout{複数のミキサー間で混合に使用するセルが重なる場合がある．}\gout{その場合，}ミキサーを用いた液滴の混合によって生成された中間液滴が，他のミキサー\gout{の液滴の混合に使用する}セルに残され，液滴の混合を進められない状態が発生する\gout{．}
    この状態のことをミキサーのオーバーラップと呼ぶ．\gout{本}節では，ミキサーのオーバーラップへの対処として行われる操作，フラッシングについて説明する．
    
    %図~\ref{fig:flushing}に表現した試薬合成のPMD上での実行中にミキサーのオーバーラップが必ず発生する混合木の例と，その混合木で表現された試薬合成をPMD上で実行する際に行われるフラッシングのプロセスを示した．
    図~\ref{fig:flushing}に試薬合成中にミキサーのオーバーラップが必ず発生する混合木の例と，その混合木の試薬合成を実行する際に行われるフラッシングの過程を示した．
    図~\ref{fig:flushing}（a）の混合木の試薬合成中では，ミキサーのオーバーラップが必ず発生する．
    その理由を説明する．
    図~\ref{fig:flushing}（a）の混合木において点線で囲んでいる，\gout{子ノードから}M$0$への提供比率は5:1である．
    そして，M$0$と，M$0$の子\mout{ノード}M$1$は6セルを使用するミキサーなので，PMD上に配置される際のミキサーの形は必ず短辺2セル，長辺3セルの長方形になる．
    したがって，短辺2セル，長辺3セルの6セルを使用する\mout{親ノードの}ミキサー（M$0$）上に，同じ大きさの\mout{子ノードの}ミキサー（M$1$）が5セル分の提供液滴を残すためには，6セル全てが重なるミキサーの配置方法を取る以外ない．
    M$1$の\mout{兄弟ノードM$2$のミキサー}も，M$0$\gout{を配置した}セルの内の1セルに提供液滴を残すため，1セルがM$0$に重なるように配置する必要がある．
    以上の理由で，M$1$\gout{を配置する}セルとM$2$\gout{を配置する}セルが重なり，M$1$とM$2$のオーバーラップは必ず発生する．
    図~\ref{fig:flushing}（a）の点線部の5:1のように，ミキサーのオーバーラップの発生が確定している提供比率のことをオーバーラップ確定提供比率と呼ぶ．
    このように，\mout{子ノードのミキサーのサイズと，子ノードから親ノードのミキサー}への液滴の提供比率に基づいて，ミキサーのオーバーラップの発生を予測することがある程度可能である．
    
    図~\ref{fig:flushing}（b）に示したPMDには，M$1$の混合によって生成された中間液滴が残されている．\gout{図~\ref{fig:flushing}（b)から（d）において，}網掛け\mout{さ}れているセル\mout{をセルAと呼ぶ．セルAはM1の兄弟ノードの}ミキサーであるM$2$の提供液滴の配置予定セルである．
    M$1$での液滴の混合によって生成された中間液滴が，\mout{セルA}に残された状態では，M$1$とM$2$のオーバーラップが発生したままとなる．
    図~\ref{fig:flushing}（c）では，ミキサーのオーバーラップを解消するため，\mout{セルA}に残された中間液滴を緩衝液という液体を用いて洗い流す操作（フラッシング）を行っている．
    フラッシングが行われた後の図~\ref{fig:flushing}（d）において，中間液滴が残されていた\mout{セルA}は，空きセルになっている．
    図~\ref{fig:flushing}（e）は，M$1$とのミキサーのオーバーラップが解消されたM$2$での液滴の混合が行われた後のPMDである．試薬合成におけるフラッシング回数と比例して，試薬合成における使用緩衝液量は増加する．
    使用緩衝液量の増加は実験コストの増加に繋がる．したがって，実験コストの増加を抑えるために試薬合成におけるフラッシング回数を削減することが求められている．

 \begin{figure}[tbp]
    \centering\includegraphics[scale=0.7]{img/flushing.pdf}
    \caption{試薬合成中にミキサーのオーバーラップが必ず発生する混合木と，試薬合成におけるフラッシングのプロセス}\label{fig:flushing}
    
\end{figure}

